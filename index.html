<!-- 버튼 -->
<button id="openArBtn" class="control-btn capture-btn">📷 네이티브 AR 열기</button>

<!-- Capacitor 브리지 -->
<script src="capacitor.js"></script>
<script>
  // ✅ Capacitor가 준비될 때까지 대기 (JS에서 너무 일찍 호출하면 못 찾음)
  function waitCapacitorReady(timeout = 4000) {
    return new Promise((resolve) => {
      if (window.Capacitor?.Plugins) return resolve(true);
      const start = Date.now();
      const id = setInterval(() => {
        if (window.Capacitor?.Plugins) { clearInterval(id); resolve(true); }
        else if (Date.now() - start > timeout) { clearInterval(id); resolve(false); }
      }, 50);
    });
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const ready = await waitCapacitorReady();
    if (!ready) {
      alert('Capacitor 준비 실패(타임아웃). 네트워크/로딩을 확인해주세요.');
      return;
    }

    // 🔎 자체 진단: 플러그인 목록 표시
    // alert('Plugins: ' + Object.keys(window.Capacitor.Plugins || {}));

    const ArLauncher = window.Capacitor.Plugins.ArLauncher;
    if (!ArLauncher) {
      alert('ArLauncher 플러그인을 찾을 수 없습니다.');
      return;
    }

    // 🔎 ping 테스트 (네이티브 플러그인 로딩 확인)
    try {
      const ping = await ArLauncher.ping();
      console.log('ArLauncher.ping()', ping);
    } catch (e) {
      alert('ArLauncher.ping 실패: ' + (e.message || e));
    }

    // 버튼 동작
    document.getElementById('openArBtn')?.addEventListener('click', async () => {
      try {
        const res = await ArLauncher.open();
        console.log('ArActivity launched:', res);
      } catch (e) {
        alert('네이티브 실행 실패: ' + (e.message || e));
      }
    });
  });
</script>
