<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>ì œì£¼ ë§›ì§‘ AR</title>

  <!-- ìºì‹œ ë¬´íš¨í™” -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- âœ… GitHub Pages ìƒëŒ€ê²½ë¡œ ê¹¨ì§ ë°©ì§€ -->
  <base href="https://bible6392-coder.github.io/jeju-ar-map/">

  <style>
    body { margin:0; background:#000; color:#fff; font-family:sans-serif; text-align:center; }
    .badge { position:fixed; top:10px; left:10px; color:#0f0; font:12px/1 monospace; z-index:9999 }
    .wrap { height:100vh; display:flex; align-items:flex-end; justify-content:center; }
    .controls { display:flex; gap:20px; margin-bottom:40px; }
    .btn { width:120px; height:50px; border:none; border-radius:12px; font-size:16px; cursor:pointer; }
    .btn-primary { background:#ff6b6b; color:#fff; }
    .btn-gray { background:#eee; color:#000; }
  </style>
</head>
<body>
  <div class="badge">v-2025-08-26-ë””ë²„ê·¸</div>

  <div class="wrap">
    <div class="controls">
      <button id="openArBtn" class="btn btn-primary">ğŸ“· ë„¤ì´í‹°ë¸Œ AR ì—´ê¸°</button>
      <button id="locBtn" class="btn btn-gray">ğŸ“ ìœ„ì¹˜</button>
    </div>
  </div>

  <!-- Capacitor ë¸Œë¦¬ì§€ -->
  <script src="capacitor.js"></script>
  <script>
    // âœ… ë””ë²„ê·¸: JS ì—ëŸ¬ë¥¼ alertë¡œ í‘œì‹œ
    window.onerror = (msg, src, line, col, err) => {
      alert("JS ì—ëŸ¬: " + msg + "\\n@" + src + ":" + line + ":" + col);
    };
    console.log("âœ… index.html loaded");

    function waitCapacitorReady(timeout = 4000) {
      return new Promise((resolve) => {
        if (window.Capacitor?.Plugins) return resolve(true);
        const start = Date.now();
        const id = setInterval(() => {
          if (window.Capacitor?.Plugins) { clearInterval(id); resolve(true); }
          else if (Date.now() - start > timeout) { clearInterval(id); resolve(false); }
        }, 50);
      });
    }

    async function init() {
      const ready = await waitCapacitorReady();
      if (!ready) {
        alert('Capacitor ì¤€ë¹„ ì‹¤íŒ¨');
        return;
      }

      const openBtn = document.getElementById('openArBtn');
      const locBtn  = document.getElementById('locBtn');

      openBtn?.addEventListener('click', async () => {
        try {
          const Ar = window.Capacitor.Plugins.ArLauncher;
          if (!Ar) return alert('ArLauncher í”ŒëŸ¬ê·¸ì¸ ì—†ìŒ');
          const res = await Ar.open();
          console.log('ArActivity launched:', res);
        } catch (e) {
          alert('ë„¤ì´í‹°ë¸Œ ì‹¤í–‰ ì‹¤íŒ¨: ' + (e.message || e));
        }
      });

      locBtn?.addEventListener('click', async () => {
        try {
          const G = window.Capacitor.Plugins.Geolocation;
          if (!G) return alert('Geolocation í”ŒëŸ¬ê·¸ì¸ ì—†ìŒ');
          const pos = await G.getCurrentPosition();
          alert(`ìœ„ì¹˜: ${pos.coords.latitude}, ${pos.coords.longitude}`);
        } catch (e) {
          alert('ìœ„ì¹˜ ì‹¤íŒ¨: ' + (e.message || e));
        }
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
