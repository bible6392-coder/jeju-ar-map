<!-- ë²„íŠ¼ -->
<button id="openArBtn" class="control-btn capture-btn">ğŸ“· ë„¤ì´í‹°ë¸Œ AR ì—´ê¸°</button>

<!-- Capacitor ë¸Œë¦¬ì§€ -->
<script src="capacitor.js"></script>
<script>
  // âœ… Capacitorê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸° (JSì—ì„œ ë„ˆë¬´ ì¼ì° í˜¸ì¶œí•˜ë©´ ëª» ì°¾ìŒ)
  function waitCapacitorReady(timeout = 4000) {
    return new Promise((resolve) => {
      if (window.Capacitor?.Plugins) return resolve(true);
      const start = Date.now();
      const id = setInterval(() => {
        if (window.Capacitor?.Plugins) { clearInterval(id); resolve(true); }
        else if (Date.now() - start > timeout) { clearInterval(id); resolve(false); }
      }, 50);
    });
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const ready = await waitCapacitorReady();
    if (!ready) {
      alert('Capacitor ì¤€ë¹„ ì‹¤íŒ¨(íƒ€ì„ì•„ì›ƒ). ë„¤íŠ¸ì›Œí¬/ë¡œë”©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
      return;
    }

    // ğŸ” ìì²´ ì§„ë‹¨: í”ŒëŸ¬ê·¸ì¸ ëª©ë¡ í‘œì‹œ
    // alert('Plugins: ' + Object.keys(window.Capacitor.Plugins || {}));

    const ArLauncher = window.Capacitor.Plugins.ArLauncher;
    if (!ArLauncher) {
      alert('ArLauncher í”ŒëŸ¬ê·¸ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    // ğŸ” ping í…ŒìŠ¤íŠ¸ (ë„¤ì´í‹°ë¸Œ í”ŒëŸ¬ê·¸ì¸ ë¡œë”© í™•ì¸)
    try {
      const ping = await ArLauncher.ping();
      console.log('ArLauncher.ping()', ping);
    } catch (e) {
      alert('ArLauncher.ping ì‹¤íŒ¨: ' + (e.message || e));
    }

    // ë²„íŠ¼ ë™ì‘
    document.getElementById('openArBtn')?.addEventListener('click', async () => {
      try {
        const res = await ArLauncher.open();
        console.log('ArActivity launched:', res);
      } catch (e) {
        alert('ë„¤ì´í‹°ë¸Œ ì‹¤í–‰ ì‹¤íŒ¨: ' + (e.message || e));
      }
    });
  });
</script>
